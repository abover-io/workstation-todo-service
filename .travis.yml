sudo: required
services:
  - docker
before_script:
  - docker swarm init
  - printf $JWT_ACCESS_SECRET | docker secret create JWT_ACCESS_SECRET -
  - printf $JWT_REFRESH_SECRET | docker secret create JWT_REFRESH_SECRET -
  - printf $JWT_API_KEY_SECRET | docker secret create JWT_API_KEY_SECRET -
  - printf $COOKIE_SECRET | docker secret create COOKIE_SECRET -
script:
  - docker stack deploy --compose-file=docker-compose.dev.yml fancy-todo-api
after_success:
  - docker ps -q -f name=fancy-todo-api_api
  - docker ps
  - docker exec $(docker ps -q -f name=fancy-todo-api_api) yarn test
env:
  global:
    - secure: K+jguvPriL/eFX3Y+uqHndsnVg92Tv+vJygF3p5LvAK2LPRCQkLsIS511YR73swAuHMrhzuv4k8w0Gv+ybah711P+dwxbrfRcqR0jGQ2Wii8QL3pH/PILT9ZJ35cxe4MpYMVrkj7toWUXGbmQFQudhb2tuMRyB+3Y2hAEpYELaW27VB6PU5xMKQTakPlK+Q96hqiM90aOe2Jdz2UGTpSqF3aXMZq/cH0PtVyqLp4+6dl9+JBEJTi38wHoTujAoAFy1wQVEmJ56c1DW1eiO5X/uYSKOBOfPa6NdD4arR8IeieZekoESWkTaN0yR6lRVcT9dqn2Am7aaWqSEUqZKS9xmaRBji1sohis8p2ZvSeLdwCD5Qqxf4yDPkHOov8U1R6VcMxOqoMqSJgKKxLYBuuq5Klwse6CI5wW4f+ESJucLrVcTACRHlauTCyygFjDXLQkge9SZRYuXaZOugNOFdMxUWcB9T+vXVFcAqQMEoQzcCE5CmjnRV+AMT+Ds6G5ybA09inrZVSU5+TMyXtbCrmherp2kKNDXFwr59yquuSHs/PPMZe3IBJXv63srGeFSSh4D+0APh4+ALanLZ1CupmzEklCTg4EWwBSOVifxF5tCVrmqYTLBhZnGAX2mKC8HnNKUuVuIyKsWARzkXVMeVUMqicWNMS2hTc4Awwkw4/fLU=
    - secure: W0C+UQIy0bVXtcF0+T5t7oIW9h+ONBEW3rrTkh29WNtN/MUaq2eqV9iCxDwxI0txUdl7UsVZ8IosscIiLaydW2YbhwUeHWY/0qzkcuWsR7KGbifcIvwA4LB/zvWL+uT7EfoHPL+MNs7OMpyNoZwQNI0UCYOFOHqo6cNcno6Ji+NSC1yPM7CYoQ1+jfpjItih9WDvj7taelpJhX8/FSNhS5pvVGOLaljDA2cQRCCdLgkR/gOebfhNQX+NA79Abmhlo2C1asUmJ5I4kTPSUzozPyScBIpV6RMTyQmvsCoKEGL7lwAxHFPw06yERqixxngO0zTwdVng+/IutNjAKJKOU6lgMC4E4zNNbcJyItjCuIcXa7QKznaKmmWDghD1JHZnrD57hIH2HTsIDQd1jiW6MDXPZU1WYFKb09RZacjVE3njWJusC1IXLRyljLSBvvFxLn/GVM1kdarvgJd6YR0IIZyx0MK1LOgZhOTh5MSDNXDm2+gq4WcICsJ3s0cWXnFQxOy5H6Jx5If3SPLBiXQNgNK78p0/7ItUVZwhwmJYNH2PBQViLzMh1UXzZeADLehe9FdWxln+JNRxojDgie6eXqw79K9tZrY+E77i0lriLlvqCyPFo1x642eqHqN+Jq+9fQADvIq/skQZQcKMoTvu0mTs0a98vx9bYCMntnJAR5Y=
    - secure: bM9Ug+bxBef7wVO+XrCsUd57//4URVMOFja9jBN0hWjARYKUXtSo9ClHYrYBe0T/CvGTYvUu2Gfx//pMUOOUuOXXKv6GM6yI9tePJrw+YQwYeoDMOmvdA+BtX9ssGMVfy1NeEq1ejL9xWYWuukguCWOK3Tbcrrne9Fnsj6/JwE/eFkol7U77Mq52DppG0Ue6mD446Rz/mg0anP/u+wHNciJrwjsayIkVaV6fzKV5JijbBzGlu01Ld53pm05BlKl3vIW369euXj6pkeYRwaPEzJk9/5VERiS7IJtO4yUa5reRZS51Mq/XO9JJVznh4AHiB4K0Wdf6621Sgjw2ixtyP0OO6AcTOPR5hYox3S/UFrnOdE3pFmFLB2+3PaDI3bnHy84LJEtY1E2TFKRMNDUZAyEMDzwGm8jHfP2bIPZZFAiqKauikhm/cPRphfaKn/6n4IYtn1jI3Qf19JPfVENM64Es44e2yA5NDxB4NLRv1j/Xpzqgu93Wxbp44JTdgZco/saYIaVu4/qehkqV7lk/OBAVWsI4afbHLUP+CC2JfzlzciTw16Gc53aHonRjLt4LxuQ/+i/094hjoMjL3rHPcKlcsmg358XzJ6+nqjLluQQ3ShrK/wjeNjRUmt03ADXn6Ph0UZdZM0TtdR62sVvYrO7otxA1Zetooij4zfeAHQQ=
    - secure: kDWH7SKsbzO6xm37JWseZnRoIXdLamGjlsDDdb6dymH9FIUTSzkFkjawBj7/xKZyQ1MBWfD1JUCaZ5EBTIe5bN9ua/H3/CO5W6cGFbNHbrdyA7p79QW+xMQZToXA/RKgTJnPrsfBQGJFNz6zXnWIJzZgmfdhbx/PC65GdpXoS0aXT5Y6GHWzAhp2LSCjJr0oTjRtapyKyyO8wQLCFIZefO7YtUMVK26u5ZBooahuQ9e9leAlGkC7v3HKu2XxDB3DgJiTWHwWIZT/poQXUULbg+3TimK0sV+HV+4jmAHFmO7n7SweXz/IbekOKmDMfvxVrmJivbVmw3dlw6dkqBT/pojTK3ulRvDQzZQs7rUmZy8nZ7JL0HCyX+xdx3EpfdY0Gb9B9FZLArpTJWs5RFEYfXKTtle0tcBdJBgxgvR2mXY+02pMDrod45rokDF2lV1CrbSJcA2Tlk6KpMu8cXQ1CA5Lt1OGmSSm3zh5zmhERugjLTfcwiwQJKqfYhwJhkAJkZJr6jtX377Y7PWK5yR4PYcb6RJTJZip7i5ky5uQE309Ev7YCjH6w9FMEeTxksBYVXKeTW3/DIM435fJAsjeQo8IYY6geOKFj3UncOO60mE2jpcihvKROfhohGo5RqkNYiegod1yJXuFvNtQmNn2pkqOlceDmBDufecloOPZfbk=
