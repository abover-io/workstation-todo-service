languange: node_js
node_js:
- lts/*
sudo: required
services:
- docker
install:
- docker swarm init
- printf $JWT_ACCESS_SECRET | docker secret create JWT_ACCESS_SECRET -
- printf $JWT_REFRESH_SECRET | docker secret create JWT_REFRESH_SECRET -
- printf $JWT_API_KEY_SECRET | docker secret create JWT_API_KEY_SECRET -
- printf $COOKIE_SECRET | docker secret create COOKIE_SECRET -
script:
- docker stack deploy --compose-file=docker-compose.dev.yml fancy-todo-api
- sleep 30
- docker stack --orchestrator swarm services fancy-todo-api
- docker exec -it $(docker ps -q -f name=fancy-todo-api_api) yarn test
env:
  global:
  - secure: cGdKdHHcgLuGpuuYRl83obFnXkEaC3zfSBkC+yvHdCQQU5Eu1Zz/O3AzwZH/RpFRl8I10VZ25Cr8xkjhXqTd4JkV508EiC23meUcpzwdqmgRNy4B8YteWJOAVxIXII3Q13jhoEFnqJGDnDlxftctrsRHHcFB94/WYjf96yeoPFue25MI0YWcqiMQI94MeGdMsZ4BdmcKAedf16QDwf2z/ieApVOR6qt3qbal//ssJtJ/MkAiLCnV+Dd4bQCwqQrV6QngfNnoYj35SCuNrd39Ds9GjiIuGVHHysgaaMWq0EGM/HXWI117lR15CT+L6dHeBpyKQP9DR1yqwFbB7tggm4UeQoRocsXDmHonsxzV65KCrrnWactqd9Xzk6BEHMTQGRQRHiyjcZeeqef0d8m9CpNw5YkNoF3oeCI1Y/sI+hrppIJLcIIfwIGJ8H9XNnze0hzkP2f4KMjk0/b0IB2E/X6fwpVo479IKQITezdpeq38rAJTSrlifLMHix3NJYi4toJa8v6qejLU0k8p6WSZc6dqODGllwojljndcNIICFiXYGhqRPXb5kLHxUUEFVGqXhq2qQiIJssWQyVQQQHQ8iEMfvh79R25RDHmX3Ji668RCBf0+I3sWZPWTodLmjnLUJF5lakvYO9AGonHYC+T/VhTTGonhVvMWGcU/OrEEs4=
  - secure: KBlo3BxMjmtqWmi+hIBMqvYRnpbD6IhJAbhcVdkF7GChIWZ0S+dgdYE7CaXg+y42StSeBvkrYLku1hqs7BWH8PfdrP9VEKJWL5K2YZk7NqCrJwdU36ynwh8wh+mD4zoDKooVZTuQzC9QKjzDmSoCRP1qGpiQn0WnE57TNIf44bvBreKHrGW9F8FCf3h9lPgzGdBdi159eO1Dzo5ZXBWHJ3NoHKI4+ngEkr8gP6qcdJQ7BA2lpueH7jrKrNVhc/1LqOZf+NkSgkFm/V+xXffc8IU51Ll0NGzMxKIBGq6rlzTRWKCHqskPabVmVw2kPvu2a+juj4jiF5LzedxpTU6LqRHv0KXmkcKGkphBUeo+JDRufcAhcLzT7aovVh2BHlqY4vlwwHgwpTcXwtgNBRMIgZTq5EvdkVrAjnQdN3gMtPvDISTm8JiMkcSlQWfN1pOJs1SEu2qgeh1Yp1K9duvSsRraqR44ZffEhrQ8RdWOkD/wSBNjO6JZm8s6/MZ7UtSnShXhX57AdFdaNfclg2PquItQHC2noifhAmlzPGEWORIZjA0SYlHnDs8+GyR1yKtdLtVy3hg7Xd3tKcbJ9RK6apABx85SeuLC+Mg7pV5KZ8JqNDgXfCbHt3BqxlLXOpOHMQtQJpoHKmyHbDbC+qUFMzvv50WptbI1EpU4Yjv+8KA=
  - secure: VffbsTWJcTpc2pVTnKToYDviZNcMNEPI3ZtKx/XpUuAm6+n0Di96iHNZK4jQmHzz7k35SXyd/egX9oC4xSyq56Ynb/NkWsiSbnHcr+Cl1sgfyJ8itMuiUeAMjKWE1+20+rF8yZBWHPdXN1HYNHEJZEq+z5anhHVTj/y6VM4xNmyjEri0X5kqf2Wx3VfZEAXDTxSuqtFeHbqdxsIwDVZFqq31uSJGc8lUOxsSoxVBiUSa4Aepy0zd71B7azj2e8Ab0nMWQjAyppNi0/fuVlGC1ojoaFs97nP6sYIT+FTIK/Rn/SoBawttZN7Kz3hH+2OlYPtlb+It98DxLrxMLhDCBWqps0vJoGC6bGwF+wZ9ac7pfNGkJ2WfDrwdqOumypGwxlXU6buHwSp2pP2RCm/KTagJfWjOtH7O/ScSojB2yXFiEOA77K8LLTM52+z1ElZBJsl7TvjbBilBv3ubGBp96WYg0h0CjT/vJnpDtS0CMms/+w0ti4HF6OYfWzGO/KWPriswfqqQycbPMz47TC+J4tim/xcqqfYE0ANBz/HaX/g79OVfqAPxCzR4nK1rI9DC95TJVcxL19z41jBUTO7yHxJ4CznqVIIeUkEesiaITi73M9ojt4QvVhQimO63TNIpXYVvhZy8LGyk4oXqlbVsGqgEGQe44+J0o0bB0wOjk9Q=
  - secure: lvqx0dcbZpkmhg7f6rSI9bnu0gEHGaYm+Vh24tNNWBDOksSOv+b7x9htWJftzU/0G0FFTNkvvNq2WfJzW1sK739ups1s/Q6wEt4g/zqBejoKOdvhW7o8ZRC9UGLfNWf6ekaBtVElOFqpldPH8W0R7DUZveOvlFaUgam438Rq8vD1xrOkVEzUtv5JDfrUFJPzEnjgM2feH14C9eMJSz/t5RUs9GxnDWNbxVT4wqQ6oXk/14l4JnKYJef3wqO49kUd9CqRSqXsofNS1bgjW9HPyP/JLH+Z5v5DBbdpAUJqMBxHQw4k84XcwCxw9eQ8BjH5IaMJIiEWCxykyDYxRZKHYFSE7pw+N6UJSefJmqinBWZfqkgBJtpPFBy1UkirK31xsp+W5oDS/3Kpj1X1aEuBl5tOV7MWBkIXZMrZ/njzm0S9OTjaf8JrNZMIbrgAKxrCtpY7yYxDWybe/0Q+L4GZIYjzIXZoqSXsxNU+Dz3SzqscLqk6sEoYrVuMhpj73yGc8pCYSxnIH0k7knSWtCVYv7tLfponbi63HsHiUfUmZ1ocv5LwsNPonMpgWeZB1QRjeUsfJ4dTxAI8UVUL39Fgus8B+ghbH1199QYABUUxpilivTWQSe5+LIfAC1NkLXqR6Pe7qJzAjyMigPCE3tY1kwXVYcb3MdKaHEyRHOVr6rM=
