languange: node_js
node_js:
- lts/*
sudo: required
services:
- docker
install:
- docker swarm init
- printf $JWT_ACCESS_SECRET | docker secret create JWT_ACCESS_SECRET -
- printf $JWT_REFRESH_SECRET | docker secret create JWT_REFRESH_SECRET -
- printf $JWT_API_KEY_SECRET | docker secret create JWT_API_KEY_SECRET -
- printf $COOKIE_SECRET | docker secret create COOKIE_SECRET -
script:
- docker stack deploy --compose-file=docker-compose.prod.yml fancy-todo-api
- sleep 30
- docker stack --orchestrator swarm services fancy-todo-api
- docker exec -it $(docker ps -q -f name=fancy-todo-api_api) yarn test
env:
  global:
  - secure: ID0zBSUsvlNai5Ug+Mdosxe3cQaNxDsQynFcRhht2DXzzwd5r/UE/Ak66kgJurWokzQqi5haXwfLZ4uBnmtqmPnPsVagjGLOGmCuzpR1I2wp3+sZmSXCkIPqJAqwoajxUcGIi0qC+HtFdcQtEZ4LdUIwn8gsmW6k6uWMsZ2q1vu/NH74E3FH2j7NIvUSejNxQV/4o4HiWrO6CNuaQ8Sli7eWoPYeOKHyPrHulVtvi2bqzGdYPnlpHmB8UGDA1LKM6u3dMyKgf1Q5YlUBsg34IwH+wMHeBF6L2KKHjZTAIjutmN99sNvwwJUZjbcjXjF/eVZIYlnkPpGEYJgQ6TsbSVNzD25/vMIMtrcZ7BN9uaaULa9bmLE9t2oaJHJOl0fssTB5rssHgEetL4QVjFv+Q75mCZXP10kIWkb8huc9SlR/coh0OwZzt8BDWcvHbHQIrPTHxDe4sdBuKB0Iw9RmfyA8UM2yH+qThtlE6KbmIXDFzLU7BJ8GxojdWwk4bc21busTyaFQyi0CAEI44MS55QUbUB3xsSEHNXSs8qrhnn4Swt3IoyRhTKAdnV5aAC903LX1xb9PYvIUJ7QUo/k8CEyOO5pM6GJwmNMdZvu7763aS2/VBjd0W9x4JVUDESSkcHDJXw1o0yxcB86Bms1fYUomYaaTgOtb3Y8sFj+MoqY=
  - secure: xxQ3WK7GKVXHmMyXoqyfo0nYOO+VkYP18CRgaw7t4bFAIcywUCkS92ap5ijuirRjdMYMguOS2051WyZvWNbnzXqNS1qF6M1aQTyW7w9XY+SkBtpvI3cV0oJMquftUP8J0ir+zHKvLwVm+3m+ja/ngE23s68h9kkG/j+SjVbhM5uLOSjiUJipbURiewdQzH+1B0A3mIf+3c/nUkjAOPna/xtVUXkmKcelB2eZ+IEwTUc40CM4tMgDgA++weGfyyrJwGjbPA2lc/W+YdYZkwTJl7ST1enXlh9MJoHjNYU7VtiVrwH5oWnJnQZPmbQeHX6Rkkz6KS00IwhRCKBOa6d+oR7+loCpLx5/fTggFSDDV5BDfzrOvvPcXj6vaqiN82c1bOVzLwm4oUpjsMkgO9SXww4XBnSmiPO/hfH+SaCYr8JsmBq1QK5hp8tPMFoawJuBKPriASW/92ObEfaWIcFQIk+lEY6443HAJluntXJ/Wa4Lio+thdnMCk6LgFzfMhxL61vJ4h2Wn5RiUDLBsm1S/VeNYwfF4elY4+S79fGCDTkS+8gzb9gClPwIFtz1VjaPX2u5SnuDPX6rVmu3qo1ofI01okbKyN/7LOMVyUX8jNmkPshP+cnPjJl6GIsAyKnZcCo9rm7mPAHxPAhib8IySVPfRJ0WBIVtxa8kY1G2fT0=
  - secure: libowClNbEkQvHFq9BCWI+7CGRLfud62Btu7G08kNz/DkQiwMbHmX+CsUwXekvap8Zowi0BzDEWRBtAyXkGdC0JM6F/1Y5IeXW8E6cPyCE3HCVRoNrCQ+FT5z/ba717qq/ciOFkZA3/FF5Mn0DGZqE4bDZRqwefj8SCzUt9+mpUAZkjUcGSpUhQfulZj5m0RJK6Gu6tae3wh8t0jKQ7M5JQESpwurx4DL9TmbvkKnk5fMq4GD/bdlHW/Al+gb/bGaXz/xjahJoiHxbcNThO5C53StM2ff4hq0ozkYI5guY4WDXEiLBoTFUXMOovPGFFqzPyQod6MX8cQ45LgdABNkrV60+L6WpUrv1sUZ1zui3MlE69byTNdgPl77ILFybh99Kycu+CoWod6mNjdCnN0nz2Y3yxsmmQYzXSlFSLOp3rFnrVu/BtNcwP/Dr2NZ7X8Upzk1qouAQAvl2oFp+m34oQEA/mqvh5Bs4YrN7AW47VOyCqL8s1QRo5VkbvRJrg+/6HTYA9YruyQ4bAPdpK57u2/iP+dDdbm7gVhMpTSuq2o92JsQYjVZDmDEeHrR78Ww4/uCcO2NuI6U8ufHxdIIsK+39m3LfVRqQZDTmQrxvFhxIUzX9r6Mg5CYWMaMNUMOK5/oOfRBqXQ+r5ajLeVi8CHjrq+GFw5nRaC7MnVBvY=
  - secure: QKhL50Wk8qYC9j0HvJWPtYVulI+GmyH8EQm87CtFI8/OKLqa8gQ3RtdgcTgKQR6PcMcMgrPzHBCikF5nCAt7PuevsSs5+/6/PLtnPLbUhq0jysEzJ+o1GH6o3iDSGFBpDEUOa4R1iDJqVmxt4Ud0y/yiWVdd1Ywmvqd0aazRffuRD7Lfvt7rqlLz9OtGa3HVAtHMLLBSV+lyrIbkE7OANAZfypAO2awIw/K4+0fcbrBQu14/tY1OnT1dnsIGlaCOzGXK+Q/Oc4fKEKsZoVF9oK9HvHUrDiJ2Eytxlcx9fcwFqchO4ONQTrU7BcSFjfftEWljVMjSrGf+nDxYBcLv5mj3ZPGOe5ad32lI2seloyPH9CT5Q5jsZ4yRR6RpMMC5gfb19hlsh2L3qFB5MxdHRr35KfGqbol1Ml/MeILDHD1JevETioMuy924QSF6c2NC0myrKmFCSWsaX6uGOAGto6tCBr0CqeNhShC3p9Iy6bznffuZojjmAf1VAFnIQ8N1oMTZysRT/khRJG8HL9vAWqGnlH556YICTYhU4IpWNlZbPFVDAZ4ARpJIeK4CINKDO8Ej7ikI6e6Ehk/w+KGrJl0cPE6DvJnem6TLpIID9Dlupkf6Q5OSPTER348+q+ZkvsHKgSQZG66HFHWG73CLDa8ZzBhxJ3q6R2i5PUfcK3Y=
